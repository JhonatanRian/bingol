{% extends "base/base.html" %}
{% load static %}

{% block title %}
    Registrar
{% endblock title %}

{% block content %}
    {% if success %}
        {% block links %}
            <link rel="stylesheet" href="https://2-22-4-dot-lead-pages.appspot.com/static/lp918/min/default_thank_you.css">
        {% endblock links %}
        {% block stylesheets %}
            <style>
                @import url(//cdnjs.cloudflare.com/ajax/libs/normalize/3.0.1/normalize.min.css);
                @import url(//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css);
            </style>
        {% endblock stylesheets %}
        <header class="site-header" id="header">
            <h1 class="site-header__title" data-lead-id="site-header-title">Ganhou<br> R$ 5,00 de Bônus</h1>
        </header>

        <div class="main-content">
            <i class="fa fa-check main-content__checkmark" id="checkmark"></i>
            <a href="{% url 'login'%}">
                <p class="main-content__body" data-lead-id="main-content-body">Obrigado por Cadastrar, click <b>AQUI</b> para acessar a tela de login.</p>
            </a>
        </div>

        <footer class="site-footer" id="footer">
            <p class="site-footer__fineprint" id="fineprint">Copyright ©2022 | All Rights Reserved</p>
        </footer>
    {% else %}
        <div class="d-flex flex-column flex-root">
            <!--begin::Authentication - Sign-up -->
            <div class="d-flex flex-column flex-column-fluid bgi-position-y-bottom position-x-center bgi-no-repeat bgi-size-contain bgi-attachment-fixed"
                style="">
                <!--begin::Content-->
                <div class="d-flex flex-center flex-column flex-column-fluid p-10 pb-lg-20">
                    <!--begin::Logo-->
                    <a href="" class="mb-12">
                        <img alt="Logo" src="{% static 'img/logo.png' %}" class="h-100px" />
                    </a>
                    <!--end::Logo-->
                    <!--begin::Wrapper-->
                    <div class="w-lg-600px bg-dark  rounded shadow-sm p-10 p-lg-15 mx-auto">
                        <!--begin::Form///  novalidate="novalidate" id="kt_sign_up_form"-->
                        <form class="form w-100" action="{% url 'register' %}" method="POST" id="sample_form">
                            {% csrf_token %}
                            <!--begin::Heading-->
                            <div class="mb-10 text-center text-white">
                                <!--begin::Title-->
                                <h1 class="text-white mb-3 ">Criar Conta</h1>
                                <!--end::Title-->
                                <!--begin::Link-->
                                <div class="text-gray-400 fw-bold fs-4">Já tem Conta?
                                    <a href="{% url 'login' %}" class="link-primary fw-bolder">Logar</a>
                                </div>
                                <!--end::Link-->
                            </div>
                            <!--end::Heading-->
                            <!--begin::Action-->

                            <!--end::Action-->
                            <!--begin::Separator--> 
                            <div class="d-flex align-items-center mb-10">
                                <div class="border-bottom border-gray-300 mw-50 w-100"></div>
                                <span class="fw-bold text-gray-400 fs-7 mx-2"></span>
                                <div class="border-bottom border-gray-300 mw-50 w-100"></div>
                            </div>
                            {% if msg %}
                                <span class="w-100 alert alert-danger">{{ msg }}</span>
                            {% else %}
                            {% endif %}
                            <!--end::Separator-->
                            <!--begin::Input group-->
                            <div class="row fv-row mb-7">
                                <!--begin::Col-->
                                <div class="col-xl-6">
                                    <label class="form-label fw-bolder text-white fs-6">Nome</label>
                                    {{ form.name }}
                                </div>
                                <!--end::Col-->
                                <!--begin::Col-->
                                <div class="col-xl-6">
                                    <label class="form-label fw-bolder text-white fs-6">Apelido</label>
                                    {{ form.nickname }}
                                </div>
                                <!--end::Col-->
                            </div>
                            <!--end::Input group-->
                            <!--begin::Input group-->

                            <div class="row fv-row mb-7">
                                <!--begin::Col-->
                                <div class="col-xl-6">
                                    <label class="form-label fw-bolder text-white fs-6">CPF</label>
                                    {{ form.cpf }}
                                </div>
                                <!--end::Col-->
                                <!--begin::Col-->
                                <div class="col-xl-6">
                                    <label class="form-label fw-bolder text-white fs-6">Data Nascimento</label>
                                    {{ form.birth_date }}
                                </div>
                                <!--end::Col-->
                            </div>


                            <div class="col-xl-6">
                                <label class="form-label fw-bolder text-white fs-6">Celular</label>
                                {{ form.fone }}
                            </div>

                            <div class="fv-row mb-7">
                                <label class="form-label fw-bolder text-white fs-6">Email</label>
                                {{ form.email }}
                            </div>
                            <!--end::Input group-->
                            <!--begin::Input group-->
                            <div class="mb-10 fv-row" data-kt-password-meter="true">
                                <!--begin::Wrapper-->
                                <div class="mb-1">
                                    <!--begin::Label-->
                                    <label class="form-label fw-bolder text-white fs-6">Senha</label>
                                    <!--end::Label-->
                                    <!--begin::Input wrapper-->
                                    <div class="position-relative mb-3">
                                        {{ form.password1 }}
                                        <span
                                            class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2"
                                            data-kt-password-meter-control="visibility">
                                            <i class="fas fa-eye"></i>
                                            <i class="fas fa-eye d-none"></i>
                                        </span>
                                    </div>
                                    <!--end::Input wrapper-->
                                    <!--begin::Meter-->
                                    <div class="d-flex align-items-center mb-3" data-kt-password-meter-control="highlight">
                                        <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
                                        <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
                                        <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
                                        <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px"></div>
                                    </div>
                                    <!--end::Meter-->
                                </div>
                                <!--end::Wrapper-->
                                <!--begin::Hint-->
                                <div class="text-muted">Use 8 ou mais characters </div>
                                <!--end::Hint-->
                            </div>
                            <!--end::Input group=-->
                            <!--begin::Input group-->
                            <div class="fv-row mb-5">
                                <label class="form-label fw-bolder text-white fs-6">Confirme sua senha</label>
                                {{ form.password2 }}
                            </div>
                            <!--end::Input group-->
                            <!--begin::Input group-->

                            <!--end::Input group-->
                            <!--begin::Actions/// id="kt_sign_up_submit"-->
                            <div class="text-center">
                                <button type="submit" class="btn btn-lg btn-primary" name="reg_user">
                                    <span class="indicator-label">Cadastrar</span>
                                    <span class="indicator-progress">Please wait...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                                </button>
                            </div>
                            <!--end::Actions-->
                        </form>
                        <div class="form-group" id="process" style="display:none;">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuemin="0"
                                    aria-valuemax="100" style="">
                                </div>
                            </div>
                        </div>

                        <!--end::Form-->
                    </div>
                    <!--end::Wrapper-->
                </div>
                <!--end::Content-->
                <!--begin::Footer-->
                <div class="d-flex flex-center flex-column-auto p-10">
                    <!--begin::Links-->
                    <div class="d-flex align-items-center fw-bold fs-6">
                        <a href="" class="text-muted text-hover-primary px-2">About</a>
                        <a href="" class="text-muted text-hover-primary px-2">Contato</a>
                        <a href="" class="text-muted text-hover-primary px-2">Suporte</a>
                    </div>
                    <!--end::Links-->
                </div>
                <!--end::Footer-->
            </div>
            <!--end::Authentication - Sign-up-->
        </div>
    {% endif %}


    {% block javascripts %}
        <script src="{% static 'js/plugins.bundle.js' %}"></script>
        <script src="{% static 'js/scripts.bundle.js' %}"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
        {% comment %} <script src="https://code.jquery.com/jquery-1.10.0.min.js"></script> {% endcomment %}
        <script src="https://rawgit.com/RobinHerbots/Inputmask/3.x/dist/jquery.inputmask.bundle.js"></script>
        <script>
            $("input[id*='cpf']").inputmask({
                mask: ['999.999.999-99'],
            });
            $(document).ready(function () {
                $('.js-date').mask('00/00/0000', {
                    onComplete(value, event, currentField) {
                        if ($(currentField).hasClass('birthday_affiliate')) {
                            const validate = ValidateDOB($(currentField));
                            const submit = $(currentField).parents('form').find('.js-save-item');
                            if (validate.status) {
                                submit.removeAttr('disabled');
                            } else {
                                alert(validate.message);
                                $(currentField).val('').focus();
                                submit.attr('disabled', '');
                            }
                        }
                    }
                });
                $('#data_nascimento').blur(function () {
                    const submit = $(this).parents('form').find('.js-save-item');
                    if ($(this).val() === '') {
                        $(this).val('').focus();
                        submit.attr('disabled', '');
                    }
                })
                $('.js-time').mask('00:00:00');
                $('.js-date_time').mask('00/00/0000 00:00:00');

                $('.js-cep').mask('00000-000', {
                    onComplete(cep, event, currentField) {
                        const replaceCep = cep.replace('.', '').replace('-', '');
                        const address = '.js-rua';
                        const neighborhood = '.js-bairro';
                        const city = '.js-cidade';
                        const uf = '.js-estado';
                        const number = '.js-numero';
                        $.ajax({
                            url: `https://viacep.com.br/ws/${replaceCep}/json/`,
                            type: 'post',
                            dataType: 'jsonp',
                            crossDomain: true,
                            contentType: 'application/json',
                            beforeSend() {
                                $(address).attr('disabled', true);
                                $(neighborhood).attr('disabled', true);
                                $(city).attr('disabled', true);
                                $(uf).attr('disabled', true);

                                swal({
                                    'text': 'Aguarde...',
                                    'button': false
                                });
                            },
                        })
                            .always((json) => {
                            if (json.erro) {
                                swal.close();
                                swal(
                                    'Oops...',
                                    'O CEP digitado não está correto. Tente novamente!',
                                    'error',
                                );
                                $(address).attr('disabled', false);
                                $(neighborhood).attr('disabled', false);
                                $(city).attr('disabled', false);
                                $(uf).attr('disabled', false);
                                return false;
                            }

                            $(address).attr('disabled', false);
                            $(neighborhood).attr('disabled', false);
                            $(city).attr('disabled', false);
                            $(uf).attr('disabled', false);

                            $(address).val(json.logradouro);
                            $(neighborhood).val(json.bairro);
                            $(city).val(json.localidade);
                            $(uf).val(json.uf);

                            $(number).focus();

                            swal.close();
                        });
                    }
                });
                $('.js-phone').mask('0000-0000');
                $('.js-phone_with_ddd').mask('+00 (00) 00000-0000');
                $('.js-phone_us').mask('(000) 000-0000');
                $('.js-phone_br').mask('(00) 0000-0000');
                $('.js-mixed').mask('AAA 000-S0S');
                $('.js-cpf').mask('000.000.000-00', {reverse: true});
                $('.js-cnpj').mask('00.000.000/0000-00', {reverse: true});
                $('.js-money').mask('000.000.000.000.000,00', {reverse: true});
                $('.js-money-wth-rs').mask('R$ 000.000.000.000.000,00', {reverse: true});
                $('.js-money2').mask("#.##0,00", {reverse: true});
                $('.js-ip_address').mask('0ZZ.0ZZ.0ZZ.0ZZ', {
                    translation: {
                        'Z': {
                            pattern: /[0-9]/, optional: true
                        }
                    }
                });
                $('.js-ip_address').mask('099.099.099.099');
                $('.js-percent').mask('##0,00%', {reverse: true});
                $('.js-clear-if-not-match').mask("00/00/0000", {clearIfNotMatch: true});
                $('.js-placeholder').mask("00/00/0000", {placeholder: "__/__/____"});
                $('.js-fallback').mask("00r00r0000", {
                    translation: {
                        'r': {
                            pattern: /[\/]/,
                            fallback: '/'
                        },
                        placeholder: "__/__/____"
                    }
                });
                $('.js-selectonfocus').mask("00/00/0000", {selectOnFocus: true});

                var SPMaskBehavior = function (val) {
                    return val.replace(/\D/g, '').length === 11 ? '+00 (00) 00000-0000' : '+00 (00) 00000-0000';
                },
                spOptions = {
                    onKeyPress: function (val, e, field, options) {
                        field.mask(SPMaskBehavior.apply({}, arguments), options);
                    }
                };

                $('.js-cellphones').mask(SPMaskBehavior, spOptions);
            });

            function ValidateDOB(element) {  //Get the date from the TextBox.
                var dateString = element[0].value;
                var regex = /(((0|1)[0-9]|2[0-9]|3[0-1])\/(0[1-9]|1[0-2])\/((19|20)\d\d))$/;

                let message = '';
                let status = true;

                //Check whether valid dd/MM/yyyy Date Format.
                if (regex.test(dateString)) {
                    var parts = dateString.split("/");
                    var dtDOB = new Date(parts[1] + "/" + parts[0] + "/" + parts[2]);
                    var dtCurrent = new Date();
                    message = "Você deve ter mais de 18."
                    if (dtCurrent.getFullYear() - dtDOB.getFullYear() < 18) {
                        status = false;
                        return {'status': status, 'message': message};
                    }

                    if (dtCurrent.getFullYear() - dtDOB.getFullYear() == 18) {

                        //CD: 11/06/2018 and DB: 15/07/2000. Will turned 18 on 15/07/2018.
                        if (dtCurrent.getMonth() < dtDOB.getMonth()) {
                            status = false;
                            return {'status': status, 'message': message};
                        }
                        if (dtCurrent.getMonth() == dtDOB.getMonth()) {
                            //CD: 11/06/2018 and DB: 15/06/2000. Will turned 18 on 15/06/2018.
                            if (dtCurrent.getDate() < dtDOB.getDate()) {
                                status = false;
                                return {'status': status, 'message': message};
                            }
                        }
                    }
                    message = "";
                    status = true;
                } else {
                    message = "Informe uma data com formato válido dd/mm/YYYY."
                    status = false;
                }

                return {'status': status, 'message': message};
            }


        </script>

    {% endblock javascripts %}

{% endblock content %}





<!-- Select2 -->

<script>

    //test for iterating over child elements
    var langArray = [];
    $('.vodiapicker option').each(function () {
        var img = $(this).attr("data-thumbnail");
        var text = this.innerText;
        var value = $(this).val();
        var item = '<li><img src="' + img + '" alt="" value="' + value + '"/><span>' + text + '</span></li>';
        langArray.push(item);
    })

    $('#a').html(langArray);

    //Set the button value to the first el of the array
    $('.btn-select').html(langArray[0]);
    $('.btn-select').attr('value', 'en');

    //change button stuff on click
    $('#a li').click(function () {
        var img = $(this).find('img').attr("src");
        var value = $(this).find('img').attr('value');
        var text = this.innerText;
        var item = '<li><img src="' + img + '" alt="" /><span>' + text + '</span></li>';
        $('.btn-select').html(item);
        $('.btn-select').attr('value', value);
        $(".b").toggle();
    });

    $(".btn-select").click(function () {
        $(".b").toggle();
    });

    //check local storage for the lang
    var sessionLang = localStorage.getItem('lang');
    if (sessionLang) {
        //find an item with value of sessionLang
        var langIndex = langArray.indexOf(sessionLang);
        $('.btn-select').html(langArray[langIndex]);
        $('.btn-select').attr('value', sessionLang);
    } else {
        var langIndex = langArray.indexOf('ch');
        $('.btn-select').html(langArray[langIndex]);
        //$('.btn-select').attr('value', 'en');
    }
</script>

<!--<script>-->
<!--    $('.menu-icon-mobile').on('click', function() {-->
<!--        $('.nav-mobile').toggleClass('active');-->
<!--    })-->
<!--</script>-->


<script>
    document.addEventListener('gesturestart', function (e) {
        e.preventDefault();
    });

    document.addEventListener('touchmove', function (event) {
        if (event.scale !== 1) {
            event.preventDefault();
        }
    }, false);

    var lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
        var now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
</script>
